import csv
import urllib.request

def loadMastData():
    """
        Reads incoming
        Returns 
            fieldnames and 
            data as a list of lists    
    """
    req = urllib.request.urlopen("https://datamillnorth.org/download/mobile-phone-masts/4ae9320c-e678-4e51-980e-b6d516f40bb4/Mobile%2520Phone%2520Masts.csv")
    req = req.read().decode('utf-8')
    csvDict = csv.DictReader(req.splitlines())
    #   parse fieldnames then data: (overkill)
    db = []
    fieldnames = []
    for row in csvDict:
        rec = []
        [fieldnames.append(k) for k, v in row.items() if k not in fieldnames]
        [rec.append(row.get(f,"")) for f in fieldnames]
        db.append(rec)
        
    return (fieldnames, db)

def loadMasterData_tests():
    fieldnames, db = loadMasterData()
    # expecting 42 rows
    ans = "loadMasterData %s"
    if len(db) == 42:
        return ans % "Correct number of rows loaded"
    else:
        return ans % "i rows imported - should be 42"
